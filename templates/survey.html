{% extends "layout.html" %}
{% block title %}
Survey
{% endblock %}
{% block content %}
<form action="{{url_for("survey")}}" method="POST">

<h2>{{ survey.title }}</h2>
<p>{{ survey.desc }}</p>


<div class="card">
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-6">
                <label for="firstname" class="form-label">First name:</label>
                <input type="text" class="form-control" id="firstname" name="firstname" placeholder="Oliver" required>
            </div>
            <div class="col-md-6">
                <label for="lastname" class="form-label">Last name:</label>
                <input type="text" class="form-control" id="lastname" name="lastname" placeholder="Skaarup" required>
            </div>
            <div class="col-12">
                <label for="CPR-number" class="form-label">CPR-Number</label>
                <input type="text" class="form-control" id="cpr" name="cpr" placeholder="071296-xxxx" required>
            </div>
        </div>
    </div>
</div>

{% for question in survey.questions %}
    <div class="card">
        <div class="card-body">
            <label>{{question.text}}</label> <br>
            {% for choice in question.choices %}
                <label>
                    <input type="radio" name="question_{{question.id}}" value="{{choice.id}}" data-text="{{choice.text}}" required>
                    {{choice.text}}
                </label> <br>
            {% endfor %}
            <input type="text" class="form-control" name="question_{{question.id}}_uddyb" id="question_{{question.id}}_uddyb" placeholder="Uddyb svar...">
        </div>
    </div>
    <br>
{% endfor %}
<button type="submit">Submit!</button>
<button type="button" class="btn btn-primary" onclick="saveToPDF()">Gem som PDF</button>
</form>

<script>
    async function saveToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      let y = 10;

      const getVal = id => document.getElementById(id)?.value || '';
      const getRadio = name => {
        const selected = document.querySelector(`input[name="${name}"]:checked`);
        return selected ? selected.getAttribute("data-text") || selected.value : '';
      };

      doc.setFontSize(16);
      doc.text("Besvaret Spørgeskema", 10, y);
      y += 10;

      doc.setFontSize(12);
      doc.text(`First name: ${getVal("firstname")}`, 10, y); y += 8;
      doc.text(`Last name: ${getVal("lastname")}`, 10, y); y += 8;
      doc.text(`CPR Number: ${getVal("cpr")}`, 10, y); y += 10;

      doc.text(`Spørgsmål 1: Sover du alene? Svar: ${getRadio("question_1")}`, 10, y); y += 8;
      doc.text(`Uddyb svar: ${getVal("question_1_uddyb")}`, 10, y); y += 10;

      doc.text(`Spørgsmål 2: Føler du dig veludhvilet, når du vågner? Svar: ${getRadio("question_2")}`, 10, y); y += 8;
      doc.text(`Uddyb svar: ${getVal("question_2_uddyb")}`, 10, y); y += 10;

      doc.text(`Spørgsmål 3: Har du oplevet søvn paralyse? Svar: ${getRadio("question_3")}`, 10, y); y += 8;
      doc.text(`Uddyb svar: ${getVal("question_3_uddyb")}`, 10, y); y += 10;

      doc.text(`Spørgsmål 4: Hvad laver du, fra du ligger dig i sengen, til du sover? Svar: ${getRadio("question_4")}`, 10, y); y += 8;
      doc.text(`Uddyb svar: ${getVal("question_4_uddyb")}`, 10, y); y += 10;

      doc.save("spoergeskema.pdf");
    }
  </script>

{% endblock %}